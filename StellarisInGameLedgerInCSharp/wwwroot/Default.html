<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        const jsonPromise = fetch("/api/Countries");

        // Load the Visualization API and the corechart package.
        google.charts.load('current', { 'packages': ['table'] });

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawTable);


        function getColumnHeader(name) {
            return name[0].toUpperCase() + name.substr(1);
        }



        function drawTable() {

            jsonPromise.then(response=>response.json()).then(json => {
                var data = new google.visualization.DataTable();
                var propertyNames = Object.getOwnPropertyNames(json[0]);
                propertyNames.forEach(p => {
                    data.addColumn({ type: typeof (json[0][p]), label: getColumnHeader(p) });
                });


                var rows = json.map(item => {
                    var cells = propertyNames.map(p => {
                        return item[p];
                    });
                    return cells;
                });



                data.addRows(rows);


                // Instantiate and draw our chart, passing in some options.
                var table = new google.visualization.Table(document.getElementById('table_div'));

                table.draw(data, { showRowNumber: true, width: '100%', height: '100%' });

            });
        }
    </script>
</head>

<body>
    <!--Div that will hold the pie chart-->
    <div id="table_div"></div>
</body>
</html>
